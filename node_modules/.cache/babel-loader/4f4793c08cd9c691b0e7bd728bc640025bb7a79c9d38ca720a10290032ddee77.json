{"ast":null,"code":"import{useState,useEffect}from'react';import{useApi}from'./useApi';import{useSocket}from'./useSocket';export const useAnnouncements=()=>{const{loading,error,getActiveAnnouncements,clearError}=useApi();const{socketService,isConnected}=useSocket();const[announcements,setAnnouncements]=useState([]);// Load announcements\nconst loadAnnouncements=async()=>{try{const response=await getActiveAnnouncements();if(response.success){setAnnouncements(response.data);}}catch(err){console.error('Failed to load announcements:',err);}};// Set data when component mounts\nuseEffect(()=>{loadAnnouncements();},[]);// Real-time event listeners\nuseEffect(()=>{if(!socketService||!isConnected)return;console.log('游댋 Setting up announcement listeners...');const handleNew=newAnnouncement=>{console.log('游닉 New announcement:',newAnnouncement);setAnnouncements(prev=>[newAnnouncement,...prev]);};const handleUpdate=updatedAnnouncement=>{console.log('游닉 Updated announcement:',updatedAnnouncement);setAnnouncements(prev=>prev.map(item=>item._id===updatedAnnouncement._id?updatedAnnouncement:item));};const handleDelete=deletedData=>{console.log('游닉 Deleted announcement:',deletedData.id);setAnnouncements(prev=>prev.filter(item=>item._id!==deletedData.id));};// Register listeners using socketService\nsocketService.on('announcement_created',handleNew);socketService.on('announcement_updated',handleUpdate);socketService.on('announcement_deleted',handleDelete);// Cleanup\nreturn()=>{socketService.off('announcement_created',handleNew);socketService.off('announcement_updated',handleUpdate);socketService.off('announcement_deleted',handleDelete);};},[socketService,isConnected]);const refetch=()=>{loadAnnouncements();};return{announcements,loading,error,refetch,isConnected};};","map":{"version":3,"names":["useState","useEffect","useApi","useSocket","useAnnouncements","loading","error","getActiveAnnouncements","clearError","socketService","isConnected","announcements","setAnnouncements","loadAnnouncements","response","success","data","err","console","log","handleNew","newAnnouncement","prev","handleUpdate","updatedAnnouncement","map","item","_id","handleDelete","deletedData","id","filter","on","off","refetch"],"sources":["C:/jbmmsi/client/src/hooks/useAnnouncements.js"],"sourcesContent":["import { useState, useEffect } from 'react';\r\nimport { useApi } from './useApi';\r\nimport { useSocket } from './useSocket';\r\n\r\nexport const useAnnouncements = () => {\r\n  const { loading, error, getActiveAnnouncements, clearError } = useApi();\r\n  const { socketService, isConnected } = useSocket();\r\n  const [announcements, setAnnouncements] = useState([]);\r\n\r\n  // Load announcements\r\n  const loadAnnouncements = async () => {\r\n    try {\r\n      const response = await getActiveAnnouncements();\r\n      if (response.success) {\r\n        setAnnouncements(response.data);\r\n      }\r\n    } catch (err) {\r\n      console.error('Failed to load announcements:', err);\r\n    }\r\n  };\r\n\r\n  // Set data when component mounts\r\n  useEffect(() => {\r\n    loadAnnouncements();\r\n  }, []);\r\n\r\n  // Real-time event listeners\r\n  useEffect(() => {\r\n    if (!socketService || !isConnected) return;\r\n\r\n    console.log('游댋 Setting up announcement listeners...');\r\n\r\n    const handleNew = (newAnnouncement) => {\r\n      console.log('游닉 New announcement:', newAnnouncement);\r\n      setAnnouncements(prev => [newAnnouncement, ...prev]);\r\n    };\r\n\r\n    const handleUpdate = (updatedAnnouncement) => {\r\n      console.log('游닉 Updated announcement:', updatedAnnouncement);\r\n      setAnnouncements(prev => \r\n        prev.map(item => \r\n          item._id === updatedAnnouncement._id ? updatedAnnouncement : item\r\n        )\r\n      );\r\n    };\r\n\r\n    const handleDelete = (deletedData) => {\r\n      console.log('游닉 Deleted announcement:', deletedData.id);\r\n      setAnnouncements(prev => \r\n        prev.filter(item => item._id !== deletedData.id)\r\n      );\r\n    };\r\n\r\n    // Register listeners using socketService\r\n    socketService.on('announcement_created', handleNew);\r\n    socketService.on('announcement_updated', handleUpdate);\r\n    socketService.on('announcement_deleted', handleDelete);\r\n\r\n    // Cleanup\r\n    return () => {\r\n      socketService.off('announcement_created', handleNew);\r\n      socketService.off('announcement_updated', handleUpdate);\r\n      socketService.off('announcement_deleted', handleDelete);\r\n    };\r\n  }, [socketService, isConnected]);\r\n\r\n  const refetch = () => {\r\n    loadAnnouncements();\r\n  };\r\n\r\n  return {\r\n    announcements,\r\n    loading,\r\n    error,\r\n    refetch,\r\n    isConnected\r\n  };\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}