{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState, useEffect } from 'react';\nimport { useApi } from './useApi';\nimport { useSocket } from './useSocket';\nexport const useAnnouncements = () => {\n  _s();\n  const {\n    loading,\n    error,\n    getActiveAnnouncements,\n    clearError\n  } = useApi();\n  const {\n    socketService,\n    isConnected\n  } = useSocket();\n  const [announcements, setAnnouncements] = useState([]);\n\n  // Load announcements\n  const loadAnnouncements = async () => {\n    try {\n      const response = await getActiveAnnouncements();\n      if (response.success) {\n        setAnnouncements(response.data);\n      }\n    } catch (err) {\n      console.error('Failed to load announcements:', err);\n    }\n  };\n\n  // Set data when component mounts\n  useEffect(() => {\n    loadAnnouncements();\n  }, []);\n\n  // Real-time event listeners\n  useEffect(() => {\n    if (!socketService || !isConnected) return;\n    console.log('游댋 Setting up announcement listeners...');\n    const handleNew = newAnnouncement => {\n      console.log('游닉 New announcement:', newAnnouncement);\n      setAnnouncements(prev => [newAnnouncement, ...prev]);\n    };\n    const handleUpdate = updatedAnnouncement => {\n      console.log('游닉 Updated announcement:', updatedAnnouncement);\n      setAnnouncements(prev => prev.map(item => item._id === updatedAnnouncement._id ? updatedAnnouncement : item));\n    };\n    const handleDelete = deletedData => {\n      console.log('游닉 Deleted announcement:', deletedData.id);\n      setAnnouncements(prev => prev.filter(item => item._id !== deletedData.id));\n    };\n\n    // Register listeners using socketService\n    socketService.on('announcement_created', handleNew);\n    socketService.on('announcement_updated', handleUpdate);\n    socketService.on('announcement_deleted', handleDelete);\n\n    // Cleanup\n    return () => {\n      socketService.off('announcement_created', handleNew);\n      socketService.off('announcement_updated', handleUpdate);\n      socketService.off('announcement_deleted', handleDelete);\n    };\n  }, [socketService, isConnected]);\n  const refetch = () => {\n    loadAnnouncements();\n  };\n  return {\n    announcements,\n    loading,\n    error,\n    refetch,\n    isConnected\n  };\n};\n_s(useAnnouncements, \"rl2dmXpKlERl30PT8fx/L+fmnlY=\", false, function () {\n  return [useApi, useSocket];\n});","map":{"version":3,"names":["useState","useEffect","useApi","useSocket","useAnnouncements","_s","loading","error","getActiveAnnouncements","clearError","socketService","isConnected","announcements","setAnnouncements","loadAnnouncements","response","success","data","err","console","log","handleNew","newAnnouncement","prev","handleUpdate","updatedAnnouncement","map","item","_id","handleDelete","deletedData","id","filter","on","off","refetch"],"sources":["C:/jbmmsi/client/src/hooks/useAnnouncements.js"],"sourcesContent":["import { useState, useEffect } from 'react';\r\nimport { useApi } from './useApi';\r\nimport { useSocket } from './useSocket';\r\n\r\nexport const useAnnouncements = () => {\r\n  const { loading, error, getActiveAnnouncements, clearError } = useApi();\r\n  const { socketService, isConnected } = useSocket();\r\n  const [announcements, setAnnouncements] = useState([]);\r\n\r\n  // Load announcements\r\n  const loadAnnouncements = async () => {\r\n    try {\r\n      const response = await getActiveAnnouncements();\r\n      if (response.success) {\r\n        setAnnouncements(response.data);\r\n      }\r\n    } catch (err) {\r\n      console.error('Failed to load announcements:', err);\r\n    }\r\n  };\r\n\r\n  // Set data when component mounts\r\n  useEffect(() => {\r\n    loadAnnouncements();\r\n  }, []);\r\n\r\n  // Real-time event listeners\r\n  useEffect(() => {\r\n    if (!socketService || !isConnected) return;\r\n\r\n    console.log('游댋 Setting up announcement listeners...');\r\n\r\n    const handleNew = (newAnnouncement) => {\r\n      console.log('游닉 New announcement:', newAnnouncement);\r\n      setAnnouncements(prev => [newAnnouncement, ...prev]);\r\n    };\r\n\r\n    const handleUpdate = (updatedAnnouncement) => {\r\n      console.log('游닉 Updated announcement:', updatedAnnouncement);\r\n      setAnnouncements(prev => \r\n        prev.map(item => \r\n          item._id === updatedAnnouncement._id ? updatedAnnouncement : item\r\n        )\r\n      );\r\n    };\r\n\r\n    const handleDelete = (deletedData) => {\r\n      console.log('游닉 Deleted announcement:', deletedData.id);\r\n      setAnnouncements(prev => \r\n        prev.filter(item => item._id !== deletedData.id)\r\n      );\r\n    };\r\n\r\n    // Register listeners using socketService\r\n    socketService.on('announcement_created', handleNew);\r\n    socketService.on('announcement_updated', handleUpdate);\r\n    socketService.on('announcement_deleted', handleDelete);\r\n\r\n    // Cleanup\r\n    return () => {\r\n      socketService.off('announcement_created', handleNew);\r\n      socketService.off('announcement_updated', handleUpdate);\r\n      socketService.off('announcement_deleted', handleDelete);\r\n    };\r\n  }, [socketService, isConnected]);\r\n\r\n  const refetch = () => {\r\n    loadAnnouncements();\r\n  };\r\n\r\n  return {\r\n    announcements,\r\n    loading,\r\n    error,\r\n    refetch,\r\n    isConnected\r\n  };\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}